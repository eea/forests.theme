<tal:block tal:define="foo python:request.set('disable_plone.leftcolumn', 1);
        bar python:request.set('disable_plone.rightcolumn', 1);"/>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
         i18n:domain="plone.z3cform"
         metal:use-macro="context/main_template/macros/master">

<body>
<metal:css fill-slot="style_slot">
  <link type="text/css" rel="stylesheet" href="//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" />
    <style>
        #matrix_main_table th {
            transform: rotate(270deg);
            vertical-align: middle;
            line-height: 2;
        }

        #matrix_table {
            display: block;
            overflow: auto;
        }

        #matrix_table th:nth-of-type(4), #matrix_table td:nth-of-type(4) {
            display: none;
        }
    </style>
</metal:css>

<metal:js fill-slot="javascript_head_slot">
  <script type="text/javascript" src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js">
  </script>
  <script>
        $(document).ready( function () {
            //$('#matrix_table').DataTable();
            var $matrix_main_table = $('#matrix_main_table');
            var $matrix_table = $("#matrix_table");
            var active_datatable;
            $matrix_main_table.find('td').click(function(ev) {
              var td = ev.target;
              var $row = $(ev.target).closest('tr');
              var $tds = $row.find('td');
              var num;

              $tds.each(function(idx, el) {
                if (el === td) {
                    num = idx;
                    return true;
                }
              });
              var thead = $matrix_main_table.find('th').eq(num);
              var from = thead.text();
              var to = $tds.eq(0).text();
                $.getJSON( "queryMatrixData", {
                    From: from,
                    To: to
                }).done(function( data ) {
                    var headers = data['columnDefs'];
                    var columns = [];
                    for(var header in headers) {
                       columns.push({ title: headers[header]});
                    }
                    $matrix_main_table.hide();
                    active_datatable = $matrix_table.DataTable({
                        "destroy": true,
                        data: data['data'],
                        columns: columns
                    });
                    $("#matrix_table_wrapper").show();
                });
                $(".main_table_link").click(function(ev) {
                    ev.preventDefault();
                    $("#matrix_table_wrapper").hide();
                    $matrix_main_table.show();
                });
            });
        });
  </script>
</metal:js>

<metal:content metal:fill-slot="content-title">
    <h1 class="documentFirstHeading">Land use reporting</h1>
</metal:content>
<metal:content metal:fill-slot="content">

    <div class="matrix-content clearfix"
        tal:define="tview nocall:context/queryMatrixData; data tview/get_table_data">
        <h2>TABLE 4.1 LAND TRANSITION MATRIX</h2>
        <h3>Areas and changes in areas between the previous and the current inventory year</h3>
        <a href="#" class="main_table_link">Original table</a>
        <table id="matrix_table"></table>
        <table class="table table-responsive table-striped" id="matrix_main_table">
                <thead>
                <tal:rows tal:repeat="rows data">
                    <tr tal:condition="python:repeat['rows'].index == 0">
                        <th tal:repeat="item rows" tal:content="item">Heading name</th>
                    </tr>
                </tal:rows>
                </thead>
                    
                <tbody> 
                    <tal:rows tal:repeat="rows data">
                    <tr tal:condition="python:repeat['rows'].index != 0">
                        <td tal:repeat="item rows" tal:content="item">Column name</td>
                    </tr>
                    </tal:rows>
                </tbody>
            
        </table>
    </div>

</metal:content>

</body>
</html>
